<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xu.vediorental.dao.VedioDao">

    <select id="findAllVedioInfo" resultType="VedioInfo">
      select vedioinfo.*,vediorecording.inventory from vedioinfo,vediorecording where vedioinfo.name = vediorecording.name;
    </select>

    <select id="findAllVedioRecording" resultType="VedioRecording">
        select * from vediorecording
    </select>

    <select id="findAllVacantFile" resultType="VacantFile">
        select * from vacantfile
    </select>

    <select id="findAllNoReturn" parameterType="string" resultType="NoReturnInfo">
        select a.name,a.fid,a.lend,(curdate()-a.lend+1)*b.price as amount,a.deposit from userrentalhistory as a,vedioinfo as b where a.username=#{username} and a.back is null and a.name=b.name
    </select>

    <insert id="addRecording" parameterType="LendInfo">
        insert into recordinfo(username,fid,lend,deposit) values(#{username},#{fid},#{lend},#{deposit})
    </insert>

    <update id="updateRecording" parameterType="BackInfo">
        update recordinfo set back = #{back},amount = #{amount} where username = #{username} and fid = #{fid}
    </update>

    <update id="changeInventoryByName">
        update vedioinfo set inventory = inventory+ #{param2} where name = #{param1}
    </update>

    <update id="changeInventoryById">
        update vedioinfo set inventory = inventory+ #{param2} where id = #{param1}
    </update>

    <update id="changeStatus">
        update fileinfo set status = status+#{param2} where id = #{param1}
    </update>

    <insert id="addVedio" parameterType="VedioInfo">
        insert into vedioinfo(name,inventory,price) values(#{name},#{inventory},#{price})
    </insert>

    <select id="findAllFile" resultType="AllFile">
        select * from allfile
    </select>

    <insert id="addFile" parameterType="FileInfo">
        insert into fileinfo(vid,status) values(#{vid},#{status})
    </insert>

    <select id="findAllRecording" resultType="RecordInfo">
        select * from recordinfo;
    </select>

    <select id="findAllRecordingByUsername" parameterType="string" resultType="UserRentalHistory">
        select u.name,u.fid,u.lend,u.back,u.amount,u.deposit from userrentalhistory u where u.username = #{username}
    </select>

    <delete id="deleteVedioById" parameterType="long">
        delete from vedioinfo where id =#{id}
    </delete>

    <delete id="deleteFileById" parameterType="long">
        delete from fileinfo where id =#{id}
    </delete>

    <update id="updateVedioNameById">
        update vedioinfo set name = #{param2} where id = #{param1}
    </update>

    <update id="updateVedioPriceById">
        update vedioinfo set price = #{param2} where id = #{param1}
    </update>
</mapper>